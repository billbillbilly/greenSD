% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis.R
\name{pop_weg}
\alias{pop_weg}
\title{Human Exposure to Greenspace}
\usage{
pop_weg(
  r = NULL,
  source = "gsdc",
  res = c(10, 10),
  weights = c(0.75, 0.2, 0.05),
  pop_year = 2020,
  radius = 500,
  grid_size = NULL
)
}
\arguments{
\item{r}{A SpatRaster with single/multiple greenspace layer(s), typically
the output from \code{\link[=get_gsdc_data]{get_gsdc_data()}} or \code{\link[=get_ndvi_data]{get_ndvi_data()}}.}

\item{source}{character. Data source for greenspace. Must be either \code{"gsdc"} (default)
or \code{"esa"}. If \code{"esa"}, NDVI percentiles are used to approximate greenspace fraction.}

\item{res}{numeric vector of length 2. The actual spatial resolution (in meters).
Default is \code{c(10, 10)}.}

\item{weights}{numeric vectorof length 3. Weights for combining NDVI percentiles
to estimate greenspace fraction, defaulting to \code{c(0.75, 0.2, 0.05)}
for p90, p50, and p10.}

\item{pop_year}{numeric. Year of the GHSL dataset to use.
Must be one of: 2015, 2020, 2025, or 2030. Default is 2020.}

\item{radius}{numeric. Buffer radius (in meters) used for local averaging.
Default is \code{500}.}

\item{grid_size}{numeric. Optional. If provided, output is aggregated to grid cells of
this size (in meters) and returned as an \code{sf} object.}
}
\value{
SpatRaster or sf. A \code{SpatRaster} (if \code{grid_size} is \code{NULL}) with
layers \verb{pwgf_*}, or an \code{sf} object with columns \verb{pwge_*} representing
population-weighted greenspace exposure values aggregated to each grid polygon.
}
\description{
Computes population-weighted greenspace fraction or human exposure to
greenspace based on a population-weighted exposure model (Chen et al., 2022),
using population data from the Global Human Settlement Layer (GHSL;
Pesaresi et al., 2024).
See \strong{Details} for the underlying method and assumptions.
}
\details{
This function implements the population-weighted greenspace exposure (PWGE) model:

\enumerate{
\item Start with a population raster. Each pixel \( i \) has a population value \( P_i \).
\item Create a circular buffer of radius \( d \) around each pixel center.
\item For each buffer, calculate greenspace fraction:
\deqn{G_i^d = \frac{\text{Area of greenspace within buffer}}{\text{Total buffer area}}}
\item Repeat for all \( i = 1, 2, ..., N \) grid cells.
\item Compute overall exposure:
\deqn{GE^d = \frac{\sum_i P_i \cdot G_i^d}{\sum_i P_i}}
}

When \code{source = "esa"}, greenspace fraction \( G_i \) for pixel \( i \) is estimated
from NDVI percentiles as:

\deqn{
G_i = \min\left( \max\left( w_1 \cdot \text{NDVI}_{p90} + w_2 \cdot \text{NDVI}_{p50} + w_3 \cdot \text{NDVI}_{p10},\ 0 \right),\ 1 \right)
}

where \( w_1, w_2, w_3 \) are the user-defined weights (default: 0.75, 0.2, 0.05).
This gives more weight to persistent greenness (p90) and mid-season vegetation (p50),
and less to transient low values (p10). Output is bounded within \link{0, 1}.

The greenspace fraction \eqn{G_i} for each pixel \eqn{i} is estimated by
combining the NDVI percentiles using a weighted linear model:
}
\examples{
sample_data <- terra::rast(system.file("extdata", "detroit_gs.tif", package = "greenSD"))
pwgf <- pop_weg(
  # r = sample_data,
  source = 'gsdc',
  pop_year = 2020,
  radius = 1500
)


}
\references{
Chen, B., Wu, S., Song, Y. et al. Contrasting inequality in human exposure to
greenspace between cities of Global North and Global South. Nat Commun 13,
4636 (2022). https://doi.org/10.1038/s41467-022-32258-4

Pesaresi, M., Schiavina, M., Politis, P., Freire, S., Krasnodębska, K.,
Uhl, J. H., … Kemper, T. (2024). Advances on the Global Human Settlement
Layer by joint assessment of Earth Observation and population survey data.
International Journal of Digital Earth, 17(1).
https://doi.org/10.1080/17538947.2024.2390454
}
\seealso{
\code{\link[=get_gsdc_data]{get_gsdc_data()}}, \code{\link[=get_ndvi_data]{get_ndvi_data()}}
}
